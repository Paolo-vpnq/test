<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="NNE Safety">
  <meta name="theme-color" content="#151c42">
  <title>NNE Safety Observer</title>
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="assets/icons/icon-192.png">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

  <!-- ===== Header ===== -->
  <header class="app-header">
    <div class="header-brand">
      <img src="assets/nne-logo-white.png" alt="NNE" class="header-logo">
      <span class="header-divider"></span>
      <span class="header-title">Safety Observer</span>
    </div>
    <div class="header-controls">
      <select id="langSelect" class="lang-select" aria-label="Language">
        <option value="en">EN</option>
        <option value="da">DA</option>
        <option value="pl">PL</option>
        <option value="lt">LT</option>
        <option value="ro">RO</option>
        <option value="hr">HR</option>
        <option value="sv">SV</option>
        <option value="hi">HI</option>
        <option value="sk">SK</option>
        <option value="tr">TR</option>
        <option value="de">DE</option>
        <option value="uk">UA</option>
        <option value="bg">BG</option>
        <option value="lv">LV</option>
        <option value="ga">GA</option>
      </select>
      <button id="historyBtn" class="settings-btn" aria-label="History">
        <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
      </button>
      <button id="settingsBtn" class="settings-btn" aria-label="Settings">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.32 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
      </button>
    </div>
  </header>

  <!-- ===== Status Bar ===== -->
  <div id="statusBar" class="status-bar online">
    <span data-i18n="status_online">Online</span>
  </div>

  <!-- ===== Pending Queue Badge ===== -->
  <div id="pendingBadge" class="pending-badge">
    <span id="pendingCount">0</span> <span data-i18n="pending_reports">pending reports</span>
  </div>

  <!-- ===== Install Banner ===== -->
  <div id="installBanner" class="install-banner">
    <p data-i18n="install_instructions">To install: tap <strong>Share</strong> then <strong>Add to Home Screen</strong></p>
    <button id="installDismiss" class="install-dismiss" data-i18n="dismiss">Dismiss</button>
  </div>

  <!-- ===== Main Content ===== -->
  <main class="app-main">

    <!-- Location Card (QR-first) -->
    <div class="card location-card">
      <div class="card-title" data-i18n="location">Location</div>

      <!-- QR-First: Scan button is prominent -->
      <div id="locationQrPrompt" class="location-qr-prompt">
        <button type="button" class="scan-qr-btn-large" id="scanQrBtn">
          <svg viewBox="0 0 24 24" width="36" height="36" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="3" height="3"/><line x1="20" y1="14" x2="20" y2="14.01"/><line x1="20" y1="20" x2="20" y2="20.01"/><line x1="14" y1="20" x2="14" y2="20.01"/></svg>
          <span data-i18n="scan_qr">Scan QR Code</span>
        </button>
        <a id="manualLocationLink" class="manual-location-link" data-i18n="enter_manually">Enter manually</a>
      </div>

      <!-- Set location display (shown after QR scan or manual entry) -->
      <div id="locationSet" class="location-set hidden">
        <div class="location-display">
          <div class="location-value">
            <div class="label" data-i18n="building">Building</div>
            <div class="value" id="buildingValue">--</div>
          </div>
          <div class="location-value">
            <div class="label" data-i18n="level">Level</div>
            <div class="value" id="levelValue">--</div>
          </div>
        </div>
        <a id="changeLocationLink" class="change-location-link" data-i18n="change_location">Change</a>
      </div>

      <!-- Manual entry (hidden by default) -->
      <div id="locationManual" class="location-manual hidden">
        <div class="form-group">
          <select id="buildingSelect">
            <option value="" data-i18n="select_building">Select building...</option>
          </select>
        </div>
        <div class="form-group" style="margin-top:8px">
          <select id="levelSelect">
            <option value="" data-i18n="select_level">Select level...</option>
          </select>
        </div>
        <a id="backToQrLink" class="manual-location-link" style="margin-top:8px" data-i18n="scan_qr_instead">Scan QR code instead</a>
      </div>
    </div>

    <!-- Observation Card -->
    <div class="card">
      <div class="card-title" data-i18n="observation">Observation</div>

      <!-- Category (optional) -->
      <div class="form-group">
        <label data-i18n="category">Category</label>
        <select id="safetyCategory">
          <option value="" data-i18n="select_category">Select category...</option>
        </select>
      </div>

      <!-- Description -->
      <div class="form-group">
        <label data-i18n="description">Description <span class="required">*</span></label>
        <textarea id="description" rows="4"></textarea>
      </div>
    </div>

    <!-- Photo Card -->
    <div class="card">
      <div class="card-title" data-i18n="photo">Photo</div>
      <div class="photo-section">
        <label class="photo-btn" id="btnCamera">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg>
          <span data-i18n="take_photo">Take Photo</span>
          <input type="file" accept="image/*" capture="environment" id="cameraInput" style="display:none">
        </label>
        <label class="photo-btn" id="btnGallery">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
          <span data-i18n="from_gallery">Gallery</span>
          <input type="file" accept="image/*" id="galleryInput" style="display:none">
        </label>
      </div>
      <div class="photo-grid" id="photoGrid"></div>
    </div>

    <!-- Submit -->
    <button type="button" id="submitBtn" class="submit-btn" data-i18n="submit">
      Submit Observation
    </button>

  </main>

  <!-- ===== Success / Queued Modal ===== -->
  <div id="resultModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-icon" id="modalIcon"></div>
      <h2 id="modalTitle"></h2>
      <p id="modalMessage"></p>
      <button class="modal-btn" id="modalClose" data-i18n="new_report">New Report</button>
    </div>
  </div>

  <!-- ===== Settings Screen ===== -->
  <div id="settingsScreen" class="settings-screen">
    <div class="settings-header">
      <button id="settingsBack" class="back-btn">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
      </button>
      <h2 data-i18n="settings">Settings</h2>
    </div>
    <div class="settings-body">
      <div class="settings-section">
        <div class="settings-section-header">
          <h3 data-i18n="saved_identity">Saved Identity</h3>
          <button id="settingsEditBtn" class="settings-edit-btn" aria-label="Edit">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
          </button>
        </div>
        <!-- Read-only display (default) -->
        <div id="settingsReadOnly" class="settings-readonly">
          <div class="settings-field">
            <span class="settings-label" data-i18n="main_contractor">Main Contractor</span>
            <span class="settings-value" id="settingsContractorDisplay">--</span>
          </div>
          <div class="settings-field">
            <span class="settings-label" data-i18n="observer_name">Name</span>
            <span class="settings-value" id="settingsNameDisplay">--</span>
          </div>
        </div>
        <!-- Editable form (hidden until pen click) -->
        <div id="settingsEditable" class="hidden">
          <div class="form-group">
            <label data-i18n="main_contractor">Main Contractor</label>
            <select id="settingsContractor">
              <option value="" data-i18n="select_contractor">Select...</option>
            </select>
          </div>
          <div class="form-group hidden" id="settingsOtherGroup">
            <label data-i18n="setup_other_contractor">Your contractor name</label>
            <input type="text" id="settingsContractorOther">
          </div>
          <div class="form-group">
            <label data-i18n="observer_name">Name</label>
            <input type="text" id="settingsName">
          </div>
        </div>
      </div>
      <div class="settings-section">
        <h3>Power Automate URL</h3>
        <div class="form-group">
          <input type="text" id="settingsEndpoint" placeholder="https://...">
        </div>
      </div>
      <div class="settings-actions">
        <button class="settings-btn-action hidden" id="settingsSave" data-i18n="save_settings">Save Settings</button>
        <button class="settings-btn-action" id="settingsForceSync" data-i18n="force_sync">Force Sync Now</button>
        <button class="settings-btn-action danger" id="settingsClearQueue" data-i18n="clear_queue">Clear Pending Queue</button>
      </div>
      <p style="margin-top:24px;font-size:0.7rem;color:var(--text-muted);text-align:center;">NNE Safety Observer v2.0.3</p>
    </div>
  </div>

  <!-- ===== History Screen ===== -->
  <div id="historyScreen" class="settings-screen">
    <div class="settings-header">
      <button id="historyBack" class="back-btn">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
      </button>
      <h2 data-i18n="history">History</h2>
    </div>
    <div class="settings-body" id="historyList">
      <p class="history-empty" data-i18n="history_empty">No observations sent yet.</p>
    </div>
  </div>

  <!-- ===== First-Time Setup Overlay ===== -->
  <div id="setupOverlay" class="setup-overlay">
    <div class="setup-card">
      <div class="setup-header">
        <img src="assets/nne-logo-white.png" alt="NNE" class="setup-logo">
        <h2 data-i18n="setup_title">Welcome to NNE Safety Observer</h2>
        <p class="setup-subtitle" data-i18n="setup_subtitle">Before you start, please tell us who you are</p>
      </div>

      <div class="setup-body">
        <div class="form-group">
          <label data-i18n="setup_contractor_label">Which main contractor are you working for?</label>
          <select id="setupContractor">
            <option value="" data-i18n="select_contractor">Select...</option>
          </select>
        </div>

        <div class="form-group hidden" id="setupOtherGroup">
          <label data-i18n="setup_other_contractor">Your contractor name</label>
          <input type="text" id="setupContractorOther" placeholder="">
        </div>

        <div class="form-group" style="margin-top:16px">
          <label data-i18n="setup_name_label">Your name</label>
          <p class="setup-hint" data-i18n="setup_name_hint">Optional â€” useful if your company rewards safety observations</p>
          <input type="text" id="setupName" autocomplete="name">
        </div>
      </div>

      <button type="button" class="submit-btn" id="setupDoneBtn" data-i18n="setup_done">Get Started</button>
    </div>
  </div>

  <!-- ===== QR Scanner Overlay ===== -->
  <div id="qrScannerOverlay" class="qr-scanner-overlay">
    <div class="qr-scanner-header">
      <h3 data-i18n="scan_qr">Scan QR Code</h3>
      <button id="qrCloseBtn" class="qr-close-btn">&times;</button>
    </div>
    <div class="qr-video-container">
      <video id="qrVideo" autoplay playsinline></video>
      <div class="qr-target-box"></div>
    </div>
    <div class="qr-hint" data-i18n="qr_hint">Point camera at a location QR code</div>
  </div>

  <script src="js/app.js"></script>
</body>
</html>
